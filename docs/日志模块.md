# 日志模块

## 功能需求

1. 日志消息有多个级别（log level）
2. 日志消息可能有多个目的地（appender），例如文件、终端等
3. 日志消息格式可配置（layout）
4. 日志可以设置运行时过滤器（filter），控制不同组件的日志消息级别和目的地

## 性能需求

1. 每秒写几千上万条日志的时候没有性能损耗
2. 能应对一个进程产生大量日志数据的场景
3. 不阻塞正常的执行流程（目前这个会阻塞在fwrite上）
4. 多线程中，不造成争用

假设日志库1秒能写100w条数据，如果当前的环境只需要10w/s的写入量，那么1s内日志占用10%的性能，剩余90%可以用来做业务。

假设日志库1秒能写10w条数据，如果当前的环境需要10w/s的写入量，那么这个机器就只能用来写日志了，干不了业务，日志库就严重的拖慢了性能，可能只有把日志写入量降到1w/s后，使用这个日志库才不会造成性能影响。

## 日志库设计

日志是一个典型的生产者-消费者模型，可以采用“异步”操作的思路，日志的生产者只需要把生产的日志丢到buffer中，由另外的线程来负责消费(写入磁盘)，这样写日志时就无需阻塞在io操作上了。

